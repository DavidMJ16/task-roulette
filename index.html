<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ruleta de Tareas del Hogar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center justify-center p-4">
  <!-- Pantalla de entrada -->
  <div id="setupScreen" class="w-full max-w-xl">
    <h1 class="text-2xl font-bold mb-4 text-center">Reparto de Tareas del Hogar</h1>
    
    <div class="mb-4">
      <label class="block font-semibold mb-2">Personas:</label>
      <textarea id="peopleInput" rows="4" class="w-full p-2 border rounded" placeholder="Introduce un nombre por l铆nea..."></textarea>
    </div>
    
    <div class="mb-4">
      <label class="block font-semibold mb-2">Tareas:</label>
      <textarea id="tasksInput" rows="4" class="w-full p-2 border rounded" placeholder="Introduce una tarea por l铆nea..."></textarea>
    </div>
    
    <button onclick="startGame()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full">Siguiente</button>
  </div>

  <!-- Pantalla de ruleta -->
  <div id="wheelScreen" class="hidden flex flex-col items-center w-full max-w-xl">
    <h2 class="text-xl font-bold mb-2">Turno de: <span id="currentPlayer" class="text-blue-600"></span></h2>

    <canvas id="wheelCanvas" width="300" height="300" class="my-4"></canvas>
    
    <button id="spinButton" onclick="spinWheel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded w-full">Girar ruleta</button>
    <button onclick="nextPlayer()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded w-full mt-2 hidden" id="nextButton">Siguiente participante</button>
  </div>

  <!-- Pantalla de resumen -->
  <div id="summaryScreen" class="hidden w-full max-w-xl">
    <h2 class="text-2xl font-bold mb-4 text-center">Resumen de Tareas</h2>
    <ul id="summaryList" class="list-disc pl-5 mb-4"></ul>
    <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full">Volver a empezar</button>
  </div>

  <script>
    let people = [], tasks = [], assignments = {}, currentIndex = 0, wheelColors = [];
    let rotation = 0;
    const wheel = document.getElementById('wheelCanvas');
    const ctx = wheel.getContext('2d');

    function getRandomColor() {
      const h = Math.floor(Math.random() * 360);
      const s = 70 + Math.floor(Math.random() * 30);
      const l = 50 + Math.floor(Math.random() * 10);
      return `hsl(${h}, ${s}%, ${l}%)`;
    }

    function startGame() {
      people = document.getElementById("peopleInput").value.trim().split("\n").filter(Boolean);
      tasks = document.getElementById("tasksInput").value.trim().split("\n").filter(Boolean);

      if (people.length === 0 || tasks.length === 0) {
        alert("Por favor, introduce al menos una persona y una tarea.");
        return;
      }

      // Inicializar asignaciones vac铆as
      people.forEach(p => assignments[p] = []);

      // Colores aleatorios para cada tarea
      wheelColors = tasks.map(() => getRandomColor());

      document.getElementById("setupScreen").classList.add("hidden");
      document.getElementById("wheelScreen").classList.remove("hidden");
      document.getElementById("currentPlayer").textContent = people[currentIndex];
      drawWheel(rotation);
    }

    function drawWheel(angle = 0) {
      const arcSize = (2 * Math.PI) / tasks.length;
      ctx.clearRect(0, 0, wheel.width, wheel.height);

      ctx.save();
      ctx.translate(150, 150);
      ctx.rotate(angle);

      tasks.forEach((task, i) => {
        const start = i * arcSize;
        ctx.beginPath();
        ctx.fillStyle = wheelColors[i];
        ctx.moveTo(0, 0);
        ctx.arc(0, 0, 140, start, start + arcSize);
        ctx.fill();

        ctx.save();
        ctx.rotate(start + arcSize / 2);
        ctx.translate(90, 0);
        ctx.rotate(Math.PI / 2);
        ctx.fillStyle = "#fff";
        ctx.font = "bold 12px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(task, 0, 0);
        ctx.restore();
      });

      ctx.restore();

      // Puntero
      ctx.beginPath();
      ctx.moveTo(150, 0);
      ctx.lineTo(140, 20);
      ctx.lineTo(160, 20);
      ctx.fillStyle = "red";
      ctx.fill();
    }

    function spinWheel() {
      if (tasks.length === 0) {
        alert("No quedan tareas.");
        return;
      }

      // Ocultar bot贸n mientras gira
      document.getElementById("spinButton").disabled = true;

      const arcSize = (2 * Math.PI) / tasks.length;
      const selectedIndex = Math.floor(Math.random() * tasks.length);
      const stopAngle = (2 * Math.PI * 5) + (Math.PI * 1.5 - (selectedIndex * arcSize) - arcSize / 2);
      const duration = 3000;
      const startTime = performance.now();

      function animate(time) {
        const progress = Math.min((time - startTime) / duration, 1);
        rotation = easeOutCubic(progress) * stopAngle;
        drawWheel(rotation);

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          const selectedTask = tasks[selectedIndex];
          const person = people[currentIndex];
          assignments[person].push(selectedTask);
          tasks.splice(selectedIndex, 1);
          wheelColors.splice(selectedIndex, 1);

          //  OCULTAR bot贸n de girar
          document.getElementById("spinButton").classList.add("hidden");

          // Mostrar bot贸n siguiente
          document.getElementById("nextButton").classList.remove("hidden");

          if (tasks.length === 0) {
            document.getElementById("nextButton").textContent = "Ver resumen";
          }
        }
      }

      requestAnimationFrame(animate);
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function nextPlayer() {
      currentIndex = (currentIndex + 1) % people.length;

      if (tasks.length === 0) {
        showSummary();
      } else {
        document.getElementById("currentPlayer").textContent = people[currentIndex];

        //  MOSTRAR bot贸n de girar nuevamente
        document.getElementById("spinButton").classList.remove("hidden");
        document.getElementById("spinButton").disabled = false;

        document.getElementById("nextButton").classList.add("hidden");
        drawWheel(rotation);
      }
    }

    function showSummary() {
      document.getElementById("wheelScreen").classList.add("hidden");
      document.getElementById("summaryScreen").classList.remove("hidden");

      const list = document.getElementById("summaryList");
      list.innerHTML = "";

      people.forEach(person => {
        const taskList = assignments[person];
        const li = document.createElement("li");
        li.innerHTML = `<strong>${person}:</strong> ${taskList.length ? taskList.join(", ") : "Sin tarea asignada"}`;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>
